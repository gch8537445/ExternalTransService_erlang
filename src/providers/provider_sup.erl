%%%-------------------------------------------------------------------
%%% @doc
%%% 运力提供商监督者
%%% 负责监督运力提供商管理器进程
%%% @end
%%%-------------------------------------------------------------------
-module(provider_sup).
-behaviour(supervisor).

%% API
-export([start_link/0]).

%% 监督者回调函数
-export([init/1]).

%%====================================================================
%% API 函数
%%====================================================================

%% @doc 启动监督者
start_link() ->
    supervisor:start_link({local, ?MODULE}, ?MODULE, []).

%%====================================================================
%% 监督者回调函数
%%====================================================================

%% @doc 初始化监督者
%% 定义子进程规范和监督策略
init([]) ->
    % 定义重启策略
    % one_for_one: 如果一个子进程终止，只重启该子进程
    % 最大重启次数: 1000次
    % 在多少秒内: 3600秒（1小时）
    SupFlags = #{strategy => one_for_one, 
                 intensity => 1000, 
                 period => 3600},
    
    % 运力提供商管理器
    ProviderManagerSpec = #{
        id => provider_manager,
        start => {provider_manager, start_link, []},
        restart => permanent,
        shutdown => 5000,
        type => worker,
        modules => [provider_manager]
    },
    
    % 定义子进程列表
    ChildSpecs = [ProviderManagerSpec],
    
    % 返回监督者规范
    {ok, {SupFlags, ChildSpecs}}.

%%====================================================================
%% 内部函数
%%====================================================================